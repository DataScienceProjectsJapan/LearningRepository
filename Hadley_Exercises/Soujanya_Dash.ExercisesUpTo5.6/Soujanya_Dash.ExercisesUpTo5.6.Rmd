---
title: "Soujanya_Dash.ExercisesUpTo5.6.7"
author: "Soujanya Dash"
date: "03/06/2021"
output:
  word_document: default
  html_document: default
---
## Prerequisites

```{r}
library(tidyverse)
library(nycflights13)
```

### Q.1 Brainstorm different ways to assess the typical delay characteristics of a group of flights. Consider the following scenarios:

### A flight is 15 minutes early 50% of the time, and 15 minutes late 50% of the time.
```{r echo=TRUE}
not_cancelled <- flights %>%
  filter(!is.na(air_time))
not_cancelled %>%
  group_by(tailnum) %>%
  summarise(
    count = n(),
    p_15_early_arr = mean(arr_delay < -15),
    p_15_dep_arr = mean(dep_delay < -15)
  ) %>%
  filter(p_15_early_arr > 0.5 | p_15_dep_arr > 0.5) %>%
  filter(count > 30) %>%
  arrange(desc(p_15_early_arr), desc(p_15_dep_arr))
#both arrival and departure to be taken into account.
```
### A flight is always 10 minutes late.

```{r echo=TRUE}
not_cancelled <- flights %>%
  filter(!is.na(air_time))
#as all flights should have air time
not_cancelled %>%
  group_by(tailnum) %>%
  summarise(
    count = n(),
    exact_10 = mean(arr_delay == 10)
  ) %>% 
  filter(count > 10) %>%
  arrange(desc(exact_10))
```

### A flight is 30 minutes early 50% of the time, and 30 minutes late 50% of the time.
```{r echo=TRUE}
not_cancelled %>%
  group_by(tailnum) %>%
  mutate(
    count = n(),
    arr_30_early = mean(arr_delay < -30),
    dep_30_early = mean(dep_delay < -30),
    arr_30_late  = mean(arr_delay > 30),
    dep_30_late = mean(dep_delay > 30)
  ) %>%
  arrange(desc(arr_30_early), desc(dep_30_early), arr_30_late, dep_30_late) %>%
  select(dest)
```



### Q.2 Come up with another approach that will give you the same output as not_cancelled %>% count(dest) and not_cancelled %>% count(tailnum, wt = distance) (without using count()).
Ans2. In the previous exercise, we understood that missing data would mean the plane has been cancelled. So, the approach could be by using is.na()
```{r not_cancelled, echo=TRUE}
not_cancelled <- filter(flights, !is.na(dep_delay), !is.na(arr_delay) )
```
Count() counts the number of instances of the label in a certain attribute or variable so maybe we can use group_by()&summarise().
```{r echo=TRUE}
not_cancelled %>% group_by(dest) %>% summarise(num = length(dest))
```
Similarly,for the other one,
```{r echo=TRUE}
not_cancelled %>% group_by(tailnum) %>% summarise(num = sum(distance))
```
Here we used sum instead as we want to have the total distance.

### Q.3 Our definition of cancelled flights (is.na(dep_delay) | is.na(arr_delay) ) is slightly suboptimal. Why? Which is the most important column?

If there's NA in the dep_delay, it may suggest that the flight took off and may or maynot reach the destination (given it may be redirected or crashes). on the other hand, NA in arr_delay would mean that the flight didn't take off to begin with. In any case, we may also consider taking the total delay case instead (if total delay is NA that means the flight must be cancelled).

### Q.4 Look at the number of cancelled flights per day. Is there a pattern? Is the proportion of cancelled flights related to the average delay?
Ans4. 
```{r echo=TRUE}
cancels_day <- 
  flights %>% mutate(cancelled = (is.na(arr_delay) | is.na(dep_delay))) %>%  group_by(year, month, day) %>%
  summarise(
    cancelled_num = sum(cancelled),
    flight_n = n()
)
# Since we want to know the number of observations (cancelled flights per day) 
view(cancels_day)
```
```{r}
ggplot(cancels_day) +
  geom_point(aes(flight_n, cancelled_num))
```
Next is the relation between average delay and proportion of cancelled flights (mean).
```{r echo=TRUE}
cancels_and_delays <- 
  flights %>%
  mutate(cancelled = (is.na(arr_delay) | is.na(dep_delay))) %>%
  group_by(year, month, day) %>%
  summarise(
    cancelled_prop = mean(cancelled),
    avg_dep_delay = mean(dep_delay, na.rm = TRUE),
    avg_arr_delay = mean(arr_delay, na.rm = TRUE)
  ) %>%
  ungroup()
```
```{r echo=TRUE}
ggplot(cancels_and_delays) +
  geom_point(aes(x = avg_arr_delay, y = cancelled_prop))
```
There is an increasing relationship.

### Q.5 Which carrier has the worst delays? 

Ans5. For finding the carrier with worst delays:
```{r echo=TRUE}
flights$delay <- flights$arr_delay+flights$dep_delay
flights %>%
  group_by(carrier) %>%
  summarise(delay = mean(delay, na.rm = TRUE)) %>%
  arrange(desc(delay))
```
F9 flight has the worst delay according to the table. 
```{r echo=TRUE}
filter(flights, carrier == "F9")
```
### Q.6 What does the sort argument to count() do. When might you use it?

The sort argument to count() sorts in descending order of n. If sort is TRUE, it will show the largest groups at the top. As in the previous questions, we can get the most common group like F9 flights being delayed the most. The following is to find the most common carrier (UA). 
```{r echo=TRUE}
flights %>%
  count(carrier, sort = TRUE)
```
```{r echo=TRUE}
flights %>%
  count(carrier)
```